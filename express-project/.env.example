# 服务器配置
PORT=3001
NODE_ENV=development

# JWT配置
JWT_SECRET=xiaoshiliu_secret_key_2025_production
JWT_EXPIRES_IN=7d
REFRESH_TOKEN_EXPIRES_IN=30d

# 数据库配置
# Prisma数据库连接URL (自动从上述配置生成，或直接配置)
# 格式: mysql://USER:PASSWORD@HOST:PORT/DATABASE
DATABASE_URL=mysql://root:123456@localhost:3306/xiaoshiliu

# 自动数据库同步配置
# 启用后，应用启动时会自动运行 prisma db push 同步表结构
# 并检查管理员表，如果为空则创建默认管理员 (用户名: admin, 密码: 123456)
AUTO_DB_PUSH=true

# API配置
API_BASE_URL=http://localhost:3001

# 上传配置
UPLOAD_MAX_SIZE=50mb
# 视频最大上传大小 (支持格式: 100mb, 200MB, 1gb 等)
VIDEO_MAX_SIZE=100mb
# 图片上传策略 (local: 本地存储, imagehost: 第三方图床, r2: Cloudflare R2)
IMAGE_UPLOAD_STRATEGY=imagehost
# 视频上传策略 (local: 本地存储, r2: Cloudflare R2)
VIDEO_UPLOAD_STRATEGY=local

# 本地存储配置
LOCAL_UPLOAD_DIR=uploads
LOCAL_BASE_URL=http://localhost:3001
# 视频存储目录
VIDEO_UPLOAD_DIR=uploads/videos
# 视频封面存储目录
VIDEO_COVER_DIR=uploads/covers

# 视频转码配置
# FFmpeg可执行文件路径
FFMPEG_PATH=/app/bin/ffmpeg
FFPROBE_PATH=/app/bin/ffprobe
# 是否启用视频转码为DASH格式 (true/false)
VIDEO_TRANSCODING_ENABLED=true
# 转码最大线程数 (避免资源占用过多)
# 建议值: CPU核心数的50-75%，如4核CPU设置为2-3
VIDEO_TRANSCODING_MAX_THREADS=4
# DASH转码输出目录格式，支持变量: {date}, {userId}, {timestamp}
# 默认格式: YYYY-MM-DD/userId/timestamp
VIDEO_DASH_OUTPUT_FORMAT={date}/{userId}/{timestamp}
# DASH分片时长（秒）
DASH_SEGMENT_DURATION=4
# 最小码率 (kbps)
DASH_MIN_BITRATE=500
# 最大码率 (kbps) - 1080p
DASH_MAX_BITRATE=5000
# 原始视频最大码率 (kbps) - 对原始视频进行压缩时使用
# 这将提供一个"原始"画质选项，保持原始分辨率但进行压缩
ORIGINAL_VIDEO_MAX_BITRATE=2200
# 支持的分辨率列表（逗号分隔），系统会智能检测视频实际分辨率，只转换存在的分辨率
# 格式: 宽x高:码率kbps
# 注意: 系统会自动根据视频宽高比等比例缩放，保证画面不变形
# 例如: 720x1280 的竖屏视频不会被强制转换为 640x360 (会变形)
# 而是会等比例缩放为适合的尺寸，如 360p 会转为 204x360
DASH_RESOLUTIONS=1920x1080:1800,1280x720:1500,854x480:900,640x360:500
# 是否删除原始视频文件（转码成功后）
DELETE_ORIGINAL_VIDEO=true
VIDEO_TRANSCODING_MAX_CONCURRENT=1

# ========== FFmpeg 高级优化参数 ==========
# 提示: 这些参数影响视频转码质量和速度，建议了解FFmpeg后再调整
# 注意: 默认使用VBR（可变比特率）模式，码率可在0到最大值之间动态变化

# H.264 编码预设 (速度vs质量权衡)
# 可选值: ultrafast, superfast, veryfast, faster, fast, medium, slow, slower, veryslow
# 建议: medium (平衡), fast (快速), slow (高质量)
FFMPEG_PRESET=medium

# H.264 编码配置 (视觉质量权衡)
# 可选值: baseline, main, high
# baseline: 兼容性最好，质量较低，适合低端设备
# main: 平衡选项，大多数设备支持
# high: 最佳质量，需要较新设备支持
# 建议: main
FFMPEG_PROFILE=main

# H.264 CRF 值 (恒定质量模式，0-51，越小质量越高)
# 建议: 23 (默认), 18-23 (高质量), 23-28 (标准质量)
# 注意: 设置CRF后使用恒定质量模式（也是动态码率），目标码率仅作为最大上限参考
# 警告: CRF值小于10会产生接近无损的视频，文件体积极大，不推荐
# 有效范围: 10-51，留空表示使用VBR码率模式（推荐，更可控）
FFMPEG_CRF=

# GOP 大小 (关键帧间隔，以帧数计)
# 建议: 等于帧率的2倍 (如30fps设为60)
# 较小值: 更精确的跳转，文件更大
# 较大值: 更好的压缩，跳转不精确
# 留空使用默认值 (自动 = 帧率*2)
FFMPEG_GOP_SIZE=

# B帧数量 (0-16)
# B帧可提高压缩效率，但增加编码复杂度
# 建议: 0-3 (快速), 3-5 (平衡), 5-8 (高压缩)
# 留空使用默认值 (通常为3)
FFMPEG_B_FRAMES=

# 参考帧数量 (1-16)
# 更多参考帧可提高质量和压缩，但增加解码复杂度
# 建议: 1-3 (兼容性), 3-5 (平衡), 5-8 (高质量)
# 留空使用默认值 (通常为3)
FFMPEG_REF_FRAMES=

# 编码复杂度 (0-9，仅VP9/AV1)
# 数值越高，编码越慢但质量越好
# 留空表示不使用VP9/AV1
FFMPEG_COMPLEXITY=

# 音频编码码率 (kbps)
# 建议: 128 (标准), 192 (高质量), 64-96 (节省带宽)
FFMPEG_AUDIO_BITRATE=128

# 音频采样率 (Hz)
# 可选: 44100, 48000
# 建议: 48000 (高质量), 44100 (标准)
FFMPEG_AUDIO_SAMPLE_RATE=48000

# 像素格式
# 建议: yuv420p (兼容性最好)
FFMPEG_PIXEL_FORMAT=yuv420p

# 是否启用硬件加速
# true: 使用GPU加速 (需要硬件支持)
# false: 使用CPU编码 (兼容性最好)
FFMPEG_HARDWARE_ACCEL=false

# 硬件加速类型 (当FFMPEG_HARDWARE_ACCEL=true时使用)
# 可选: cuda (NVIDIA), qsv (Intel), videotoolbox (macOS), vaapi (Linux)
# 留空则自动检测
FFMPEG_HARDWARE_ACCEL_TYPE=

# 视频分片上传配置
# 分片临时存储目录
VIDEO_CHUNK_TEMP_DIR=uploads/chunks
# 分片大小（字节），默认3MB
VIDEO_CHUNK_SIZE=3145728
# 分片自动清理间隔（毫秒），默认30分钟
VIDEO_CHUNK_CLEANUP_INTERVAL=1800000
# 分片过期时间（毫秒），默认2小时
VIDEO_CHUNK_EXPIRE_TIME=7200000

# ========== WebP图片优化配置 ==========
# 是否启用WebP转换 (true/false)
# 默认启用，设置为false时不进行WebP转换
WEBP_ENABLE_CONVERSION=true
# WebP质量 (1-100)
# 推荐值：85（高质量）、75（平衡）、65（高压缩）
WEBP_QUALITY=85
# 是否转换JPEG图片 (true/false)
WEBP_CONVERT_JPEG=true
# 是否转换PNG图片 (true/false)
WEBP_CONVERT_PNG=true
# 是否保留原图 (true/false)
# 注意：启用后会占用更多存储空间
WEBP_KEEP_ORIGINAL=false
# 最大宽度 (像素，留空表示不限制)
# 如果图片宽度超过此值将被等比例缩放
WEBP_MAX_WIDTH=
# 最大高度 (像素，留空表示不限制)
WEBP_MAX_HEIGHT=
# 是否使用无损压缩 (true/false)
# 无损压缩质量完美但文件更大，适合有透明背景的PNG
WEBP_LOSSLESS=false
# 透明度质量 (0-100)
# 仅对有透明背景的图片有效
WEBP_ALPHA_QUALITY=100

# ========== 水印配置 ==========
# 是否启用水印 (true/false)
# 启用后，后端会默认为所有图片添加水印
# 用户可在上传时通过 watermark=false 参数禁用水印
WATERMARK_ENABLED=false
# 水印类型: text(文字水印) 或 image(图片水印)
WATERMARK_TYPE=text
# 水印文字内容
# 支持中文字符，使用 @username 占位符自动替换为当前用户名
# 例如: "© 2025 我的网站" 或 "上传者: @username"
WATERMARK_TEXT=
# 水印字体大小 (像素)
WATERMARK_FONT_SIZE=24
# 水印字体路径 (可选，用于支持中文字体)
# 路径相对于项目根目录，例如: /fonts/SourceHanSansCN-Regular.ttf
# 
# ========== 中文字体配置说明 ==========
# 
# 【重要】librsvg（Sharp的SVG渲染器）对自定义字体支持有限
# 建议优先使用系统字体，而非通过字体路径配置
#
# 【Docker部署 - 推荐方案】在Dockerfile中安装系统字体：
#   RUN apt-get update && apt-get install -y fonts-noto-cjk fonts-wqy-zenhei
#   这会安装 Noto Sans CJK 和 文泉驿正黑 字体
#
# 【推荐字体下载】（如需使用自定义字体文件）
#   思源黑体: https://github.com/adobe-fonts/source-han-sans/releases
#   阿里巴巴普惠体: https://fonts.alibabagroup.com/
#   霞鹜文楷: https://github.com/lxgw/LxgwWenKai/releases
#
# 【自定义字体安装步骤】
#   1. mkdir -p fonts
#   2. 下载字体放入 fonts 目录
#   3. 设置: WATERMARK_FONT_PATH=/fonts/字体文件名.ttf
#   4. 重启服务器
#
# 留空时使用系统字体（Docker中需安装中文字体包）
WATERMARK_FONT_PATH=
# 水印图片路径 (当WATERMARK_TYPE=image时使用)
# 路径相对于项目根目录，例如: /images/watermark.png
# 建议使用PNG格式以支持透明度
WATERMARK_IMAGE_PATH=
# 水印透明度 (0-100)
# 0为完全透明，100为完全不透明
WATERMARK_OPACITY=50
# 水印位置 (九宫格: 1-9)
# 1=左上, 2=上中, 3=右上
# 4=左中, 5=中心, 6=右中
# 7=左下, 8=下中, 9=右下
WATERMARK_POSITION=9
# 水印定位模式: grid(九宫格) 或 precise(精确坐标)
WATERMARK_POSITION_MODE=grid
# 精确X坐标 (当WATERMARK_POSITION_MODE=precise时使用)
WATERMARK_PRECISE_X=0
# 精确Y坐标 (当WATERMARK_POSITION_MODE=precise时使用)
WATERMARK_PRECISE_Y=0
# 图片水印比例 (1-10)
# 表示水印相对于原图较小边的比例，4表示40%
WATERMARK_IMAGE_RATIO=4
# 图片水印平铺模式 (true/false)
# true=平铺整个图片, false=单个水印
WATERMARK_TILE_MODE=false
# 水印颜色 (hex格式)
WATERMARK_COLOR=#ffffff

# ========== 用户名水印配置 (独立于主水印) ==========
# 是否启用用户名水印 (true/false)
# 可以与主水印同时启用，实现双水印效果
USERNAME_WATERMARK_ENABLED=false
# 用户名水印字体大小 (像素)
USERNAME_WATERMARK_FONT_SIZE=20
# 用户名水印字体路径 (可选，用于支持中文字体)
# 请参考上方"推荐中文字体下载"说明
# 路径格式同 WATERMARK_FONT_PATH
USERNAME_WATERMARK_FONT_PATH=
# 用户名水印透明度 (0-100)
USERNAME_WATERMARK_OPACITY=70
# 用户名水印位置 (九宫格: 1-9)
USERNAME_WATERMARK_POSITION=7
# 用户名水印定位模式
USERNAME_WATERMARK_POSITION_MODE=grid
# 用户名水印精确X坐标
USERNAME_WATERMARK_PRECISE_X=20
# 用户名水印精确Y坐标
USERNAME_WATERMARK_PRECISE_Y=20
# 用户名水印颜色
USERNAME_WATERMARK_COLOR=#ffffff
# 用户名水印自定义文本
# 使用 @username 占位符代表当前用户名
# 例如: "用户: @username" 将显示为 "用户: admin"
USERNAME_WATERMARK_TEXT=@username

# 第三方图床配置（当IMAGE_UPLOAD_STRATEGY=imagehost时使用）
IMAGEHOST_API_URL=https://api.xinyew.cn/api/jdtc
IMAGEHOST_TIMEOUT=60000

# Cloudflare R2 配置（当IMAGE_UPLOAD_STRATEGY=r2或VIDEO_UPLOAD_STRATEGY=r2时使用）
# 请从 Cloudflare 控制台获取您自己的配置信息
R2_ACCESS_KEY_ID=your_r2_access_key_id_here
R2_SECRET_ACCESS_KEY=your_r2_secret_access_key_here
R2_ENDPOINT=https://your_account_id.r2.cloudflarestorage.com
R2_BUCKET_NAME=your_bucket_name_here
R2_ACCOUNT_ID=your_account_id_here
R2_REGION=auto
# 可选：如果有自定义域名，可以设置 R2_PUBLIC_URL
# R2_PUBLIC_URL=https://your-custom-domain.com

# 注意：
# 1. R2_ACCOUNT_ID 需要从 Cloudflare 控制台获取
# 2. R2_BUCKET_NAME 需要先在 Cloudflare R2 中创建存储桶
# 3. 如果使用自定义域名，需要在 Cloudflare 中配置域名绑定
# 4. 请不要将真实的密钥提交到版本控制系统中

# CORS配置
CORS_ORIGIN=http://localhost:5173

# 邮件服务配置
# 是否启用邮件功能 (true/false)
# 默认不启用，设置为true时注册需要邮箱验证
EMAIL_ENABLED=false
# SMTP服务器地址
SMTP_HOST=smtp.qq.com
# SMTP服务器端口
SMTP_PORT=465
# 是否使用SSL/TLS (true/false)
SMTP_SECURE=true
# 邮箱账号
SMTP_USER=your_email@example.com
# 邮箱密码/授权码
SMTP_PASSWORD=your_email_password
# 发件人邮箱
EMAIL_FROM=your_email@example.com
# 发件人名称
EMAIL_FROM_NAME=汐社校园图文社区

# OAuth2 登录配置
# 是否启用OAuth2登录 (true/false)
# 启用后可以使用第三方用户中心登录
OAUTH2_ENABLED=false
# 是否仅允许OAuth2登录 (true/false)
# 设置为true时，将禁用传统的用户名密码登录和注册功能
OAUTH2_ONLY_LOGIN=false
# OAuth2服务器地址（登录服务地址）
# 例如：https://login.example.com
OAUTH2_LOGIN_URL=
# OAuth2 Client ID（从管理后台获取的API令牌）
OAUTH2_CLIENT_ID=

# 余额中心配置
# 是否启用余额中心功能 (true/false)
BALANCE_CENTER_ENABLED=false
# 外部用户中心API地址
BALANCE_API_URL=https://user.yuelk.com
# API密钥（从用户中心后台获取）
BALANCE_API_KEY=
# 兑入比例：1本站积分 = X 用户中心余额
BALANCE_EXCHANGE_RATE_IN=1.0
# 兑出比例：1用户中心余额 = X 本站积分
BALANCE_EXCHANGE_RATE_OUT=1.0

# ========== 内容审核配置 ==========
# 是否启用内容审核 (true/false)
# 启用后，评论和用户昵称将通过Dify API进行关键词审核
CONTENT_AUDIT_ENABLED=false
# Dify API地址
DIFY_API_URL=http://aish.yuelk.com/v1/chat-messages
# Dify API密钥 (从Dify后台获取)
DIFY_API_KEY=

# ========== Redis 队列配置 ==========
# 是否启用异步队列 (true/false)
# 启用后，IP属地更新、内容AI审核等非重要操作将使用异步队列处理
QUEUE_ENABLED=false
# Redis 服务器地址
REDIS_HOST=localhost
# Redis 服务器端口
REDIS_PORT=6379
# Redis 密码 (如果没有密码则留空)
REDIS_PASSWORD=
# Redis 数据库索引 (0-15)
REDIS_DB=0

# 队列并发配置 (同时处理的任务数量)
# IP属地更新队列并发数
QUEUE_IP_LOCATION_CONCURRENCY=5
# 内容审核队列并发数
QUEUE_CONTENT_AUDIT_CONCURRENCY=3
# 通用任务队列并发数
QUEUE_GENERAL_TASK_CONCURRENCY=5
# 视频转码队列并发数 (建议设置为1，避免系统资源过载)
QUEUE_VIDEO_TRANSCODING_CONCURRENCY=1

# 队列重试配置
# 任务失败后的重试次数
QUEUE_RETRY_ATTEMPTS=3
# 重试延迟基数 (毫秒，使用指数退避策略)
QUEUE_RETRY_DELAY=1000

# ========== 极验验证码 (GeetestV4) 配置 ==========
# 是否启用极验验证码 (true/false)
# 启用后，注册时将使用极验验证码替代传统的SVG验证码
# 注意：启用前需要先在极验官网 (https://www.geetest.com/) 注册并获取captcha_id和captcha_key
GEETEST_ENABLED=false
# 极验验证码ID (从极验后台获取)
GEETEST_CAPTCHA_ID=
# 极验验证码密钥 (从极验后台获取，用于服务端二次校验签名)
GEETEST_CAPTCHA_KEY=